
# Stop opsc_srv
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks: 
  - name: Stop OpsCenter service
    service:
      name: "opscenterd"
      state: stopped
          
# Stop all agents
- hosts: datastax_agent 
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks:
  - name: Stop datastax-agent service
    service:
      name: "datastax-agent"
      state: stopped

# Install DSE security software dependencies on all opscenter storage nodes
- hosts: opsc_dsecore
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_install }
       
# Configure OpsCenter [opscenterd.conf]: webserver HTTPS security
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_opsc_config }
    
#distribute core DSE truststores and keystores to OPSC nodes - Deployed but not currently used.
- hosts: opsc_dsecore
  any_errors_fatal: true
  become: yes
  become_method: sudo
  roles:
    - { role: security_distribute_truststores }
    - { role: security_distribute_keystores }
    
    
# Configure the monitored and storage cluster via an API call to OpsCenter
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_opsc_cluster_configure }
    
# Start opsc_srv
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks: 
  - name: Start OpsCenter service
    service:
      name: "opscenterd"
      state: started
      
# Start all agents
- hosts: datastax_agent 
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks:
  - name: Start datastax-agent service
    service:
      name: "datastax-agent"
      state: started
      
