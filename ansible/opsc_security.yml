
# Install DSE security software dependencies on all opscenter storage nodes
- hosts: opsc_dsecore
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_install }
    
    
# Stop opsc_srv
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks: 
  - name: Stop OpsCenter service
    service:
      name: "opscenterd"
      state: stopped
      
      
# Stop all agents
- hosts: datastax_agent 
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks:
  - name: Stop datastax-agent service
    service:
      name: "datastax-agent"
      state: stopped
    

# Configure [opscenterd.conf]: OpsCenter server->agent security and webserver HTTPS security
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_opscenter }
    

# Start opsc_srv
- hosts: opsc_srv
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks: 
  - name: Start OpsCenter service
    service:
      name: "opscenterd"
      state: started
      
# Start all agents
- hosts: datastax_agent 
  any_errors_fatal: true
  become: true
  become_method: sudo
  tasks:
  - name: Start datastax-agent service
    service:
      name: "datastax-agent"
      state: started
      
