
# Run CQL security table replication and strategy changes once only on a single DSE cluster node
- hosts: dse[0]
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_prerequisites }


# Install and configure DSE security dependencies
- hosts: dse
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_install }
    

# Install and configure DSE node security to your requirements <---- EDIT LIST
- hosts: dse
  any_errors_fatal: true
  become: true
  become_method: sudo
  roles:
    - { role: security_node_to_node }
    - { role: security_client_to_node }
    - { role: security_dse_unified_auth_config }


#Stop and restart all nodes in seed order
# Stop DSE seed nodes 
- hosts: dse
  any_errors_fatal: true
  name: Start seed node 
  serial: 1
  become: true
  become_method: sudo
  vars:
    srvc_name: dse
  roles:
    - { role: stop_srvc, when: seed == 'true' } 

# Stop DSE non-seed nodes 
- hosts: dse
  any_errors_fatal: true
  name: Start non-seed node one by one
  serial: 1
  become: true
  become_method: sudo
  vars:
    srvc_name: dse
  roles:
    - { role: stop_srvc, when: seed == 'false' }

# Start DSE seed nodes 
- hosts: dse
  any_errors_fatal: true
  name: Start seed node 
  serial: 1
  become: true
  become_method: sudo
  vars:
    srvc_name: dse
  roles:
    - { role: start_srvc, when: seed == 'true' } 

# Start DSE non-seed nodes 
- hosts: dse
  any_errors_fatal: true
  name: Start non-seed node one by one
  serial: 1
  become: true
  become_method: sudo
  vars:
    srvc_name: dse
  roles:
    - { role: start_srvc, when: seed == 'false' }

